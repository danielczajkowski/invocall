const setTilesHeaderHeighestHeight = (tiles) => {
    const headers = tiles.querySelectorAll('.carousel_with_details__header');
    let heighestHeight = 0;
    headers.forEach(header => {
        header.style.height = `auto`;
    });
    headers.forEach(header => {
        if (header.offsetHeight > heighestHeight) {
            heighestHeight = header.offsetHeight;
        }
    });
    headers.forEach(header => {
        header.style.height = `${heighestHeight}px`;
    });
};

const detalisElms = document.getElementsByClassName('carousel_with_details__swiper');
const runDetailsSlider = () => {
    Array.prototype.forEach.call(detalisElms, el => {

        const swiper = new Swiper(el, {
            slidesPerView: 1.2,
            spaceBetween: 16,
            navigation: {
                nextEl: el.closest('.carousel_with_details').querySelector('.carousel_with_details__navigation__button--next'),
                prevEl: el.closest('.carousel_with_details').querySelector('.carousel_with_details__navigation__button--prev'),
            },
            breakpoints: {
                420: {
                    slidesPerView: 1.8,
                },
                520: {
                    slidesPerView: 2.1,
                },
                990: {
                    slidesPerView: 2.7,
                },
                1200: {
                    slidesPerView: 3.64,
                },
            },
            on: {
                afterInit: function () {
                    setTilesHeaderHeighestHeight(this.el);
                },
                resize: function () {
                    setTilesHeaderHeighestHeight(this.el);
                },
            },
        });
    });
};
runDetailsSlider();

function getScrollbarWidth() {
    const div = document.createElement('div');
    div.style.overflowY = 'scroll';
    div.style.width = '50px';
    div.style.height = '50px';
    div.style.visibility = 'hidden';
    document.body.appendChild(div);
    const scrollWidth = div.offsetWidth - div.clientWidth;
    document.body.removeChild(div);
    return scrollWidth;
}

const setWidthOfCarousel = () => {
    const container = document.querySelectorAll('.carousel_with_details');

    container.forEach(el => {
        const element = document.querySelector('.carousel_with_details__wrapper');
        const swiper = el.querySelector('.carousel_with_details__swiper--container');
        const swiperWrapper = el.querySelector('.carousel_with_details__swiper');

        if (window.innerWidth >= 990) {
            const style = window.getComputedStyle(element);
            let gap = style.getPropertyValue('column-gap');
            gap = parseFloat(gap);

            const closestElement = swiperWrapper.closest('.offer__col--right').offsetWidth;

            const windowWidth = window.innerWidth;
            const pageWidth = element.offsetWidth;
            const marginWidth = (windowWidth - pageWidth) / 2;
            let scrollbarWidth = getScrollbarWidth() || 0;

            scrollbarWidth = scrollbarWidth === 0 ? 0 : scrollbarWidth / 2;

            const width = closestElement + marginWidth - scrollbarWidth;

            swiper.style.width = `${width}px`;

            

            swiperWrapper.style.maxWidth = `${closestElement}px`;
        } else {
            swiper.style.width = '';
            swiperWrapper.style.maxWidth = '';
        }
    });
};


//dom loaded
document.addEventListener('DOMContentLoaded', () => {
    setWidthOfCarousel();
});

window.addEventListener('resize', () => {
    setWidthOfCarousel();
});